{% extends "home/navbar.html" %}

{% load static %}

{% block title %}
    {% if partner.pdb_id %}
        ChemoPar - {{ partner }} partner entry
    {% else %}
    ChemoPar - Unknown partner entry
    {% endif %}
{% endblock %}

{% block head %}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
{% endblock %}

{% block content %}
<style>
.inline {display:inline;}
.graphcolor {
              display:inline-block;
              padding: 1px 5px;
              text-align: center;
              margin-left: 20px;
              vertical-align: middle;
              width: 20px;
              height: 20px;
              margin-top: 5px;}
</style>

<div class="container">
<div class="row">
	<div class="col-md-6">
	
    {% if not partner %}
    <h2>Incorrect linkage
    {% else %}
	<h2> {{ partner.name }}</a>
    {% endif %}
        {% if chain %}
            - chain {{ chain.chain_ID }}
        {% endif %}
    </h2>
	<br>
    <p>Structures: 
        {% for structure in partner.structures.all %}
            <a target="_blank" href="/structure/{{ structure }}">{{ structure }}</a> 
        {% empty %}
            No structures
        {% endfor %}
    </p>
    <p>Partner Type: {{ partner.type }}</p>
    <p>Partner Chain: {{ partner.chain }}</p>

    {% if structure.doi != None %}
    {% else %}
        {% if structure.pdb_id %}
        <p>Publication: 
            {{ structure.doi }} (not found)
        </p>
        {% endif %}
    {% endif %}


	{% if chains %}
        <h4>Chains: 
	        {{ structure.chains }}
        </h4>
    {% endif %}

    </div>

    
    <div class="col-md-6">

        <div id="viewport" style="width:500px; height:400px;"></div>
        <div style="width:500px; background-color:#eaeaea; border-radius: 0px 0px 5px 5px;">
            <p style="padding: 2px 0px 2px 5px; font-size: 10px;"><button id="fullscreen">Full Screen</button><a href="https://github.com/arose/ngl" target='_blank'> NGL</a> is a WebGL based 3D viewer powered by <a href="https://mmtf.rcsb.org" target='_blank'>MMTF</a>.</p>
        </div>
    </div>

</div>
<div class="row">
    <div class="col-md-10">
        <div class="btn-group" role="group" aria-label="Basic example">
            <div style='display:inline; margin-left: 10px;'>
                <button  type="button" class="btn btn-primary" id="structure_download_button"><span class="glyphicon glyphicon-download-alt"></span> Structures</button>
            </div>
            <div style='display:inline; margin-left: 10px;'>
                <button  type="button" class="btn btn-primary" id="pymol_download_button"><span class="glyphicon glyphicon-download-alt"></span> Pymol session</button>
            </div>
            <div style='display:inline;'>
                <span class="glyphicon glyphicon-info-sign" data-toggle="tooltip" style="cursor:pointer;font-size:20px;" title="Please note that you may need a license for Pymol in order to open the Pymol session files. The fully featured Pymol suite is maintained and distributed by SchrÃ¶dinger at https://pymol.org/2/. Open-source alternatives with limited functionalities are available from Sourceforge and Conda-forge."></span>
            </div>
        </div>
    </div>
</div>
</div>

{% block addon_js %}
    <script src="{% static 'home/js/ngl.js' %}"></script>    
    <script type="text/javascript" src="https://cdn.rawgit.com/arose/ngl/v2.0.0-dev.39/dist/ngl.js"> </script>  

    <script>
        $(document).ready(function() {
            // NGL viewer
            stage = new NGL.Stage("viewport", { backgroundColor: "white" } );

            // Load PDB data from the Django context variable '{{ structure_pdb.0.pdbdata.pdb }}'
            var pdbData = `{{ structure_pdb }}`;

            // Create a Blob and File objects to represent the PDB data
            var stringBlob = new Blob([pdbData], { type: 'text/plain' });
            var file = new File([stringBlob], "something.pdb");

            // Load the PDB file into the NGL viewer
            stage.loadFile(file, { defaultRepresentation: true });
            $('[data-toggle="tooltip"]').tooltip();
            // if ('{{ alphafold }}'!=='False') {
            //     var color_residues = JSON.parse('{{color_residues|safe}}');
            //     // color_residues.push(["darkorchid","*"])
            //     var schemeId = NGL.ColorMakerRegistry.addSelectionScheme( color_residues );
            //     stage.loadFile( file, { defaultRepresentation: true } ).then( function( o ){
            //         o.addRepresentation( "cartoon", {color: schemeId} );  // pass schemeId here ,{ color: schemeId }
            //         o.centerView();

            //     });
            // } else {
            stage.loadFile( file, { defaultRepresentation: true } );
            // }
            $( "#fullscreen" ).click(function() {
                stage.toggleFullscreen();
            });

        });
    </script>
{% endblock %}

{% block chain_content %}{% endblock %}

{% endblock %}

